dealauth
===========================================================================

dealauthは自分のログイン出来るノード全ての`authorized_keys`をrsyncを用いて適切に更新するツールです。

The English version of README is available as README.md .

使い方
---------------------------------------------------------------------------

1. まず`pubkey.d/`というディレクトリを`dealauth.py`と同じ階層に作ります。もし作りたくなければ任意のディレクトリを`-k`または`--key-dir`オプションで指定すればいいです。

   `pubkey.d/`の例は`doc/`の中にあるのでこれを見ながら以下を読むとわかりやすいかもしれません。

2. `pubkey.d/`の下に`dealauth.conf`と言う名前のファイルを作成します。以下に例を示します。

   ```
   [foo]
   Allow: bar client

   [foobar]
   Allow: bar client
   VcsAllow: foo
   GitAllow: baz
   ```

   設定例は次のような意味になります。
    * `foo`グループのノードには`bar`, `client`グループのノードからログイン出来る。
    * `foobar`グループのノードにも`bar`, `client`グループのノードからログイン出来る。
      `foobar`グループは同時に`foo`からのVCSのアクセスと`baz`グループからのGitでのアクセスが可能である。

   注意してほしい点として、`tmp`と言う名前のグループを利用するのは避けて下さい。というのも、`pubkey.d/tmp/`をdealauth自身が一時ファイルの格納先に利用するからです。このディレクトリ以外のディレクトリを利用して欲しい場合`-t`, `--tmp-dir`オプションで明示的に他のディレクトリを指定すれば大丈夫です。

3. 次は公開鍵を用意します。まず`pubkey.d/`以下に設定ファイルに出てきたグループ名と同じ名前のディレクトリを作ります。上の例でいうと`foo`, `bar`, `client`, `foobar`, `baz`というディレクトリを作る必要があります。そして各グループのディレクトリ内に所属するノードの公開鍵を配置します。鍵のファイル名は「SSHでログイン出来る名前」+`.pub`である必要があります。

4. 最後にコマンドを実行しましょう。

   ```
   ./dealauth.py
   ```

   dealauthはauthorized_keysに相当するファイルを`/tmp`以下に作成して各ノードにrsyncで配布します。
